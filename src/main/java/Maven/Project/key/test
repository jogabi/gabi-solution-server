@PostMapping("/keys/usage/increment")
@Transactional
public Map<String, Object> incrementUsage() {
    // 현재 사용 가능한 키(id)를 뷰에서 가져오기
    Map<String, Object> row = jdbcTemplate.queryForMap(
        "SELECT id, current_api_key FROM v_api_key LIMIT 1"
    );

    Long id = ((Number) row.get("id")).longValue();
    String apiKey = (String) row.get("current_api_key");

    int updated = jdbcTemplate.update(
        "UPDATE api_keys SET used_today = used_today + 1 WHERE id = ?",
        id
    );
    if (updated == 0) {
        throw new ResponseStatusException(HttpStatus.NOT_FOUND, "사용 가능한 api_key 없음");
    }

    Integer used = jdbcTemplate.queryForObject(
        "SELECT used_today FROM api_keys WHERE id = ?",
        Integer.class, id
    );

    return Map.of("api_key", apiKey, "used_today", used);
}
